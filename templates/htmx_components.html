<!-- HTMX + DaisyUI Component Library -->

<!-- Loading Spinner -->
<div id="htmx-loading" class="htmx-indicator fixed top-4 right-4 z-50">
    <div class="alert alert-info shadow-lg">
        <span class="loading loading-spinner loading-sm"></span>
        <span>Loading...</span>
    </div>
</div>

<!-- Toast Notification Container -->
<div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2 w-80"></div>

<!-- Modal Container -->
<div id="modal-container" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="modal-box bg-base-100 rounded-lg shadow-xl max-w-2xl w-full mx-4">
        <div id="modal-content"></div>
    </div>
</div>

<!-- Confirmation Dialog -->
<div id="confirm-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
    <div class="modal-box bg-base-100 rounded-lg shadow-xl max-w-md w-full mx-4">
        <h3 class="text-lg font-bold mb-4">Confirm Action</h3>
        <p id="confirm-message" class="mb-6"></p>
        <div class="modal-action">
            <button id="confirm-yes" class="btn btn-primary">Yes</button>
            <button id="confirm-no" class="btn btn-ghost">Cancel</button>
        </div>
    </div>
</div>

<!-- Progress Bar -->
<div id="progress-bar" class="fixed top-0 left-0 h-1 bg-primary transition-all duration-300 z-50" style="width: 0%"></div>

<!-- HTMX Scripts -->
<script>
// HTMX configuration
htmx.config.useTemplateFragments = true;
htmx.config.globalViewTransitions = true;

// Toast notification function
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container');
    const toastId = 'toast-' + Date.now();

    const toastHTML = `
        <div id="${toastId}" class="alert alert-${type} shadow-lg fade-in">
            <span>${message}</span>
            <button class="btn btn-sm btn-ghost btn-circle" onclick="this.parentElement.remove()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    `;

    toastContainer.insertAdjacentHTML('beforeend', toastHTML);

    // Auto-remove after 5 seconds
    setTimeout(() => {
        const toast = document.getElementById(toastId);
        if (toast) toast.remove();
    }, 5000);
}

// Modal functions
function openModal(content) {
    const modal = document.getElementById('modal-container');
    const modalContent = document.getElementById('modal-content');
    modalContent.innerHTML = content;
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

function closeModal() {
    const modal = document.getElementById('modal-container');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}

// Progress bar functions
function showProgress() {
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = '0%';
    progressBar.style.display = 'block';

    let width = 0;
    const interval = setInterval(() => {
        width += 10;
        progressBar.style.width = width + '%';
        if (width >= 90) {
            clearInterval(interval);
        }
    }, 100);
}

function hideProgress() {
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = '100%';
    setTimeout(() => {
        progressBar.style.display = 'none';
        progressBar.style.width = '0%';
    }, 300);
}

// Confirmation dialog
function showConfirm(message, onConfirm) {
    const dialog = document.getElementById('confirm-dialog');
    const messageEl = document.getElementById('confirm-message');
    const yesBtn = document.getElementById('confirm-yes');
    const noBtn = document.getElementById('confirm-no');

    messageEl.textContent = message;
    dialog.classList.remove('hidden');
    dialog.classList.add('flex');

    const cleanup = () => {
        dialog.classList.add('hidden');
        dialog.classList.remove('flex');
        yesBtn.onclick = null;
        noBtn.onclick = null;
    };

    yesBtn.onclick = () => {
        onConfirm();
        cleanup();
    };

    noBtn.onclick = cleanup;
}

// HTMX event handlers
document.addEventListener('htmx:beforeRequest', function(evt) {
    showProgress();
});

document.addEventListener('htmx:afterRequest', function(evt) {
    hideProgress();
});

document.addEventListener('htmx:responseError', function(evt) {
    showToast('Request failed: ' + evt.detail.xhr.status, 'error');
    hideProgress();
});

document.addEventListener('htmx:sendError', function(evt) {
    showToast('Network error occurred', 'error');
    hideProgress();
});

// Auto-close modal when clicking outside
document.getElementById('modal-container').addEventListener('click', function(evt) {
    if (evt.target === this) {
        closeModal();
    }
});

// Handle flash messages from HTMX responses
document.addEventListener('htmx:afterSwap', function(evt) {
    const flashMessages = document.querySelector('.flash-messages');
    if (flashMessages) {
        const messages = flashMessages.querySelectorAll('.alert');
        messages.forEach(msg => {
            const message = msg.querySelector('span').textContent;
            const type = msg.classList.contains('alert-success') ? 'success' :
                        msg.classList.contains('alert-error') ? 'error' : 'info';
            showToast(message, type);
        });
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(evt) {
    if (evt.key === 'Escape') {
        closeModal();
        const dialog = document.getElementById('confirm-dialog');
        if (!dialog.classList.contains('hidden')) {
            dialog.classList.add('hidden');
            dialog.classList.remove('flex');
        }
    }
});
</script>