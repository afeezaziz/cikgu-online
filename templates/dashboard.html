{% extends 'base.html' %}

{% block title %}Dashboard - SPM Online Learning{% endblock %}

{% block content %}
<section class="py-8 bg-base-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Welcome Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-base-content mb-2">Selamat kembali, {{ current_user.name }}!</h1>
                    <p class="text-base-content/70">Teruskan pembelajaran anda ke arah kecemerlangan SPM</p>
                </div>
                <div class="flex items-center space-x-4">
                    {% if current_user.picture %}
                        <img src="{{ current_user.picture }}" alt="Profile" class="w-12 h-12 rounded-full">
                    {% else %}
                        <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center">
                            <span class="text-primary-content font-semibold">{{ current_user.name[0].upper() }}</span>
                        </div>
                    {% endif %}
                    <a href="{{ url_for('main.logout') }}" class="btn btn-ghost btn-sm">
                        Logout
                    </a>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card bg-primary text-primary-content">
                <div class="card-body">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-primary-content/80 text-sm">Masa Belajar</p>
                            <p class="text-3xl font-bold">{{ total_study_time }} minit</p>
                        </div>
                        <div class="text-4xl">‚è∞</div>
                    </div>
                </div>
            </div>

            <div class="card bg-secondary text-secondary-content">
                <div class="card-body">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-secondary-content/80 text-sm">Topik Selesai</p>
                            <p class="text-3xl font-bold">{{ completed_topics }}</p>
                        </div>
                        <div class="text-4xl">‚úÖ</div>
                    </div>
                </div>
            </div>

            <div class="card bg-accent text-accent-content">
                <div class="card-body">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-accent-content/80 text-sm">Fail Diupload</p>
                            <p class="text-3xl font-bold">{{ total_uploads }}</p>
                        </div>
                        <div class="text-4xl">üìÅ</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Progress by Subject -->
            <div class="card bg-base-200">
                <div class="card-body">
                    <h2 class="card-title text-xl mb-4">Kemajuan mengikut Mata Pelajaran</h2>
                    <div class="space-y-4">
                        {% for progress in progress_by_subject %}
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">{{ progress.subject.title() }}</span>
                                <span class="text-sm text-base-content/70">
                                    {{ progress.completed_topics or 0 }}/{{ progress.total_topics }}
                                </span>
                            </div>
                            <div class="w-full bg-base-300 rounded-full h-2">
                                {% set percentage = ((progress.completed_topics or 0) / progress.total_topics * 100) if progress.total_topics > 0 else 0 %}
                                <div class="bg-primary h-2 rounded-full" style="width: {{ percentage }}%"></div>
                            </div>
                        </div>
                        {% else %}
                        <p class="text-base-content/70 text-center py-4">Belum ada kemajuan direkodkan</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card bg-base-200">
                <div class="card-body">
                    <h2 class="card-title text-xl mb-4">Tindakan Cepat</h2>
                    <div class="space-y-3">
                        <a href="{{ url_for('main.upload_file') }}" class="btn btn-primary w-full">
                            üì§ Upload Fail Pembelajaran
                        </a>
                        <a href="{{ url_for('main.subjects') }}" class="btn btn-secondary w-full">
                            üìö Teruskan Belajar
                        </a>
                        <a href="{{ url_for('main.progress') }}" class="btn btn-accent w-full">
                            üìä Lihat Kemajuan
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
            <!-- Recent Study Sessions -->
            <div class="card bg-base-200">
                <div class="card-body">
                    <h2 class="card-title text-xl mb-4">Sesi Belajar Terkini</h2>
                    <div class="space-y-3">
                        {% for session in recent_sessions %}
                        <div class="flex items-center justify-between p-3 bg-base-300 rounded-lg">
                            <div>
                                <p class="font-medium">{{ session.subject.title() }}</p>
                                <p class="text-sm text-base-content/70">
                                    {{ session.session_date.strftime('%d %b %Y, %I:%M %p') }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold">{{ session.duration }} minit</p>
                            </div>
                        </div>
                        {% else %}
                        <p class="text-base-content/70 text-center py-4">Belum ada sesi belajar</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Recent Uploads -->
            <div class="card bg-base-200">
                <div class="card-body">
                    <h2 class="card-title text-xl mb-4">Upload Terkini</h2>
                    <div class="space-y-3">
                        {% for upload in recent_uploads %}
                        <div class="flex items-center justify-between p-3 bg-base-300 rounded-lg">
                            <div>
                                <p class="font-medium">{{ upload.original_filename }}</p>
                                <p class="text-sm text-base-content/70">
                                    {{ upload.uploaded_at.strftime('%d %b %Y, %I:%M %p') }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm">{{ upload.file_type.upper() }}</p>
                                <p class="text-xs text-base-content/70">{{ "%.1f"|format(upload.file_size / 1024 / 1024) }} MB</p>
                            </div>
                        </div>
                        {% else %}
                        <p class="text-base-content/70 text-center py-4">Belum ada fail diupload</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}